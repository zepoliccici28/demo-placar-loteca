<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Demo Placar ao Vivo ‚Äî LOTECA</title>
  <meta name="description" content="Demo de placar ao vivo para lotecaonline.com.br com atualiza√ß√£o autom√°tica e som de gol.">
  <style>
    :root { font-family: system-ui, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #0f172a; color: #e2e8f0; }
    a { color: #93c5fd; }

    .topbar { display:flex; gap:.75rem; align-items:center; padding:16px 20px; background:#111827; border-bottom:1px solid #1f2937; }
    h1 { margin:0; font-size:1.25rem; }
    .badge { background:#1d4ed8; padding:2px 8px; border-radius:999px; font-size:.75rem; }

    .container{max-width:1000px;margin:0 auto;padding:0 16px}

    .card { margin:20px; padding:16px; background:#111827; border:1px solid #1f2937; border-radius:16px; }
    .note { opacity:.85; margin:.5rem 0 1rem; }

    .btn {
      display:inline-block; padding:10px 14px; border-radius:10px;
      border:1px solid #1f2937; background:#1d4ed8; color:#fff;
      text-decoration:none; font-weight:600; cursor:pointer;
    }
    .btn:hover { filter:brightness(1.05); }

    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .label { font-size:.95rem; opacity:.9; }
    input[type="range"] { width:180px; }

    .matches { list-style:none; padding:0; margin:0; display:grid; gap:12px; }
    .match { display:flex; justify-content:space-between; align-items:center; gap:10px;
             padding:12px 14px; background:#0b1220; border:1px solid #1f2937; border-radius:12px; }
    .team { display:flex; gap:8px; align-items:center; }
    .team .name { font-weight:600; }
    .score { font-size:1.25rem; font-weight:700; min-width:72px; text-align:center; }
    .status { font-size:.85rem; opacity:.85; }
    .last-update { margin-top:10px; font-size:.85rem; opacity:.75; }
    .footer { padding:20px; text-align:center; opacity:.7; }

    @media (min-width:700px){
      .matches { grid-template-columns: repeat(2,minmax(0,1fr)); }
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="container">
      <h1>Placar ao Vivo (Demo) <span class="badge">vers√£o demo</span></h1>
    </div>
  </header>

  <div class="container">
    <!-- CTA para abrir o site oficial -->
    <section class="card">
      <h2>Placar oficial</h2>
      <p class="note">
        O site oficial n√£o permite ser exibido dentro de outros sites. Clique abaixo para abrir em nova aba:
      </p>
      <p>
        <a class="btn" href="https://www.lotecaonline.com.br/" target="_blank" rel="noopener">
          Abrir placar oficial
        </a>
      </p>
    </section>

    <!-- Prefer√™ncias: som e volume -->
    <section class="card">
      <h2>Prefer√™ncias</h2>
      <div class="row">
        <button id="enable-sound" class="btn">üîä Ativar som</button>
        <label class="label"><input type="checkbox" id="sound-enabled" /> Tocar som quando sair gol</label>
        <label class="label">Volume: <input type="range" id="volume" min="0" max="100" value="60" /></label>
        <button id="simulate-goal" class="btn">‚öΩ Simular gol</button>
      </div>
      <p class="note">Por pol√≠ticas do navegador, √© preciso clicar em ‚ÄúAtivar som‚Äù uma vez para permitir √°udio.</p>
    </section>

    <!-- Lista de partidas -->
    <section class="card">
      <h2>Lista de partidas (Atualiza a cada 30s)</h2>
      <ul id="matches" class="matches"></ul>
      <div id="last-update" class="last-update"></div>
    </section>

    <footer class="footer">
      <small>Demo para <a href="https://www.lotecaonline.com.br/" target="_blank" rel="noreferrer">lotecaonline.com.br</a></small>
    </footer>
  </div>

  <script>
    // ===== CONFIG =====
    const USE_WORKER = false; // quando tiver um endpoint real, mude para true
    const WORKER_URL = "https://SEU-WORKER.cloudflare.workers.dev/placar"; // ajuste quando usar API
    const REFRESH_MS = 30_000;

    // ===== MOCK (para demo imediata) =====
    let mock = [
      { home:"Flamengo-RJ", away:"Palmeiras-SP", scoreHome:1, scoreAway:0, minute:"34'", status:"1¬∫T" },
      { home:"Internacional-RS", away:"Sport-PE",   scoreHome:0, scoreAway:0, minute:"INT", status:"Intervalo" },
      { home:"Corinthians-SP",   away:"Atl√©tico-MG", scoreHome:2, scoreAway:2, minute:"‚Äî",  status:"Final" },
      { home:"Cruzeiro-MG",      away:"Fortaleza-CE", scoreHome:0, scoreAway:0, minute:"‚Äî", status:"Hoje 20:00" }
    ];

    const elList = document.getElementById("matches");
    const elLast = document.getElementById("last-update");
    const elEnableSound = document.getElementById("enable-sound");
    const elToggleSound = document.getElementById("sound-enabled");
    const elVolume = document.getElementById("volume");
    const elSimulate = document.getElementById("simulate-goal");

    // ===== √ÅUDIO =====
    let audioCtx = null;
    let isSoundEnabled = false;
    let volume = 0.6;

    elEnableSound.addEventListener("click", async () => {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      try { await audioCtx.resume(); } catch {}
      elEnableSound.textContent = "Som habilitado ‚úÖ";
    });
    elToggleSound.addEventListener("change", e => { isSoundEnabled = e.target.checked; });
    elVolume.addEventListener("input", e => { volume = Number(e.target.value)/100; });

    function playGoalSound(){
      if (!audioCtx || !isSoundEnabled) return;
      const now = audioCtx.currentTime;
      const master = audioCtx.createGain();
      master.gain.value = volume;
      master.connect(audioCtx.destination);

      // "chime" curto em duas notas
      const o1 = audioCtx.createOscillator();
      const o2 = audioCtx.createOscillator();
      o1.type = "square";  o2.type = "sawtooth";
      o1.frequency.setValueAtTime(880, now);     // A5
      o2.frequency.setValueAtTime(1320, now);    // E6

      o1.connect(master); o2.connect(master);
      o1.start(now); o2.start(now);
      o1.stop(now + 0.25); o2.stop(now + 0.25);
    }

    // ===== RENDER =====
    function render(matches){
      elList.innerHTML = "";
      matches.forEach(m=>{
        const li = document.createElement("li");
        li.className = "match";
        li.innerHTML = `
          <div class="team"><span class="name">${m.home}</span></div>
          <div class="score">${m.scoreHome} - ${m.scoreAway}</div>
          <div class="team"><span class="name">${m.away}</span></div>
          <div class="status">${m.status}${m.minute ? " ‚Ä¢ " + m.minute : ""}</div>
        `;
        elList.appendChild(li);
      });
      elLast.textContent = "Atualizado: " + new Date().toLocaleTimeString();
    }

    // ===== DETEC√á√ÉO DE GOLS =====
    // Guarda a soma de gols anterior para cada partida
    const previousScores = new Map(); // key "home|away" -> totalGols

    function detectGoals(matches){
      let goalHappened = false;
      matches.forEach(m=>{
        const key = `${m.home}|${m.away}`;
        const total = Number(m.scoreHome||0) + Number(m.scoreAway||0);
        const prev = previousScores.get(key);
        if (prev !== undefined && total > prev) goalHappened = true;
        previousScores.set(key, total);
      });
      if (goalHappened) playGoalSound();
    }

    // ===== CARREGAMENTO =====
    function setLoading(){ elList.innerHTML = "<li class='match'>Carregando‚Ä¶</li>"; }
    function setError(){ elList.innerHTML = "<li class='match'>N√£o foi poss√≠vel atualizar agora. Tentando novamente‚Ä¶</li>"; }

    async function load(){
      try{
        setLoading();
        if (USE_WORKER) {
          const res = await fetch(WORKER_URL, { cache:"no-store" });
          if (!res.ok) throw new Error("HTTP " + res.status);
          const data = await res.json(); // esperado: [{home, away, scoreHome, scoreAway, minute, status}]
          detectGoals(data);
          render(Array.isArray(data) && data.length ? data : mock);
        } else {
          // Demo com mock
          detectGoals(mock);
          render(mock);
        }
      } catch(e){
        console.error(e);
        setError();
        render(mock);
      }
    }

    // Bot√£o "Simular gol" para demonstra√ß√£o
    elSimulate.addEventListener("click", () => {
      // escolhe uma partida aleat√≥ria e incrementa um gol
      const i = Math.floor(Math.random() * mock.length);
      if (Math.random() < 0.5) mock[i].scoreHome++; else mock[i].scoreAway++;
      mock[i].status = "2¬∫T";
      mock[i].minute = String( Math.min(90, (Number(mock[i].minute)||0) + 1) ) + "'";
      // For√ßa detec√ß√£o e renderiza√ß√£o
      detectGoals(mock);
      render(mock);
    });

    load();
    setInterval(load, REFRESH_MS);
  </script>
</body>
</html>
